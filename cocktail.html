<!DOCTYPE html>
<html lang="fr">
<head>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 fill=%22%230000AA%22>:v</text></svg>">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C0CKT@1L.EXE // Bar Vitaliste</title>
<style>
@keyframes neonPulse { 0%,100%{text-shadow:0 0 10px #FF00FF;}50%{text-shadow:0 0 20px #FF00FF, 0 0 30px #FF00FF;} }
@keyframes shake { 0%,100%{transform:rotate(0deg);}25%{transform:rotate(-15deg);}75%{transform:rotate(15deg);} }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);} }

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #0000AA;
  font-family: "Courier New", monospace;
  overflow: hidden;
  cursor: none;
  min-height: 100vh;
}

canvas { display: block; }

.custom-cursor {
  position: fixed;
  width: 20px;
  height: 20px;
  border: 2px solid #FFFFFF;
  border-radius: 50%;
  pointer-events: none;
  z-index: 100000;
  mix-blend-mode: difference;
  transition: transform 0.1s, border-color 0.2s;
}

.custom-cursor.grabbing {
  transform: scale(1.5);
  border-color: #FFFF00;
}

.logo {

  position: fixed;
  top: 10px;
  left: 10px;
  border: 2px solid #FFFFFF;
  padding: 4px 8px;
  text-decoration: none;
  color: #FFFFFF;
  z-index: 1001;
  background: transparent;
  transition: background 0.2s;
}

.logo:hover { background: #FFFFFF; }
.logo span { background: #FFFFFF; color: #0000AA; padding: 0 4px; font-weight: bold; }

.win95-window {
  position: fixed;
  background: #C0C0C0;
  border: 2px outset #FFFFFF;
  box-shadow: 3px 3px 0 rgba(0,0,0,0.5);
  z-index: 1000;
}

.win95-titlebar {
  background: linear-gradient(90deg, #000080, #1084d0);
  color: #FFFFFF;
  padding: 3px 6px;
  font-weight: bold;
  font-size: 11px;
}

.win95-content { padding: 8px; font-size: 10px; color: #000; }

.stats-panel {
  bottom: 8px;
  left: 50%;
  transform: translateX(-50%);
  width: 360px;
}

.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
.stat-item { background: #FFFFFF; border: 1px inset #808080; padding: 3px 6px; }
.stat-label { font-size: 8px; color: #666; }
.stat-value { font-size: 10px; font-weight: bold; color: #000080; }

.tooltip {
  position: fixed;
  background: #FFFFCC;
  border: 2px solid #000;
  padding: 10px 14px;
  max-width: 320px;
  box-shadow: 3px 3px 0 rgba(0,0,0,0.4);
  z-index: 100001;
  font-size: 11px;
  pointer-events: none;
  display: none;
  line-height: 1.4;
}

.tooltip-title { font-weight: bold; color: #000080; font-size: 14px; margin-bottom: 5px; border-bottom: 2px solid #000080; padding-bottom: 5px; }
.tooltip-origin { font-size: 11px; color: #555; margin-bottom: 6px; font-style: italic; }
.tooltip-desc { color: #333; font-size: 11px; }

.neon-sign {
  position: fixed;
  top: 8px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 20px;
  font-weight: bold;
  color: #FF00FF;
  text-shadow: 0 0 10px #FF00FF, 0 0 20px #FF00FF;
  animation: neonPulse 2s infinite;
  z-index: 500;
  letter-spacing: 4px;
}

.shaker-indicator {
  position: fixed;
  bottom: 100px;
  right: 15px;
  background: rgba(0,0,0,0.9);
  border: 2px solid #FFD700;
  padding: 12px;
  color: #FFD700;
  font-size: 11px;
  text-align: center;
  z-index: 1000;
  display: none;
}

.shaker-indicator.visible { display: block; }
.shaker-indicator.shaking { animation: shake 0.1s infinite; }

.critique-bubble {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #FFFFCC;
  border: 3px solid #000;
  padding: 20px;
  max-width: 380px;
  box-shadow: 6px 6px 0 rgba(0,0,0,0.4);
  z-index: 100002;
  font-size: 12px;
  display: none;
  animation: fadeIn 0.3s ease;
}

.critique-bubble.visible { display: block; }
.critique-header { font-weight: bold; font-size: 16px; color: #000080; border-bottom: 2px solid #000080; padding-bottom: 8px; margin-bottom: 10px; }
.critique-score { font-size: 36px; font-weight: bold; text-align: center; margin: 15px 0; }
.critique-text { font-style: italic; line-height: 1.6; margin-bottom: 15px; font-size: 13px; }
.critique-close { display: block; width: 100%; padding: 10px; background: #C0C0C0; border: 2px outset #FFFFFF; cursor: pointer; font-weight: bold; font-size: 12px; }
.critique-close:active { border: 2px inset #808080; }

.control-btn {
  position: fixed;
  bottom: 8px;
  background: #C0C0C0;
  border: 2px outset #FFFFFF;
  padding: 6px 14px;
  cursor: pointer;
  font-family: "Courier New", monospace;
  font-size: 11px;
  font-weight: bold;
  z-index: 1000;
}

.control-btn:active { border: 2px inset #808080; }
#btnReset { right: 200px; }
#btnShake { right: 115px; }
#btnTest { right: 8px; }
</style>
</head>
<body>

<a href="borne.html" class="logo"><span>:vitalism</span></a>
<div class="custom-cursor" id="cursor"></div>

<div class="tooltip" id="tooltip">
  <div class="tooltip-title" id="tooltipTitle"></div>
  <div class="tooltip-origin" id="tooltipOrigin"></div>
  <div class="tooltip-desc" id="tooltipDesc"></div>
</div>

<div class="neon-sign">üç∏ BAR VITALISTE üç∏</div>

<div class="win95-window stats-panel">
  <div class="win95-titlebar">üìä Statistiques</div>
  <div class="win95-content">
    <div class="stats-grid">
      <div class="stat-item"><div class="stat-label">BOUTEILLE</div><div class="stat-value" id="statBottle">Aucune</div></div>
      <div class="stat-item"><div class="stat-label">NIVEAU</div><div class="stat-value" id="statLevel">0%</div></div>
      <div class="stat-item"><div class="stat-label">INGR√âDIENTS</div><div class="stat-value" id="statIngredients">0</div></div>
      <div class="stat-item"><div class="stat-label">EXTRAS</div><div class="stat-value" id="statExtras">0</div></div>
    </div>
    <div style="margin-top:5px;padding:4px;background:#FFFFFF;border:1px inset #808080;">
      <div class="stat-label">COMPOSITION</div>
      <div id="composition" style="font-size:9px;max-height:25px;overflow-y:auto;">-</div>
    </div>
  </div>
</div>

<button class="control-btn" id="btnReset" onclick="resetGlass()">üîÑ RESET</button>
<button class="control-btn" id="btnShake" onclick="shakeGlass()">üßâ SHAKE</button>
<button class="control-btn" id="btnTest" onclick="testCocktail()">‚≠ê TEST</button>

<div class="shaker-indicator" id="shakerIndicator">üßâ SHAKING...<br><span id="shakeCount">0</span> secousses</div>

<div class="critique-bubble" id="critiqueBubble">
  <div class="critique-header">üé© LE CRITIQUE DIT...</div>
  <div class="critique-score" id="critiqueScore">0%</div>
  <div class="critique-text" id="critiqueText"></div>
  <button class="critique-close" onclick="closeCritique()">FERMER</button>
</div>

<canvas id="canvas"></canvas>

<script>
const cursor = document.getElementById('cursor');
const tooltip = document.getElementById('tooltip');
const tooltipTitle = document.getElementById('tooltipTitle');
const tooltipOrigin = document.getElementById('tooltipOrigin');
const tooltipDesc = document.getElementById('tooltipDesc');

let isDragging = false;

document.addEventListener('mousemove', e => {
  cursor.style.left = e.clientX + 'px';
  cursor.style.top = e.clientY + 'px';
});

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;

window.addEventListener('resize', () => {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
  repositionElements();
});

const alcohols = [
  { name: "Vodka", color: "#E8E8E8", origin: "üá∑üá∫ Russie / Pologne", desc: "Spiritueux neutre distill√© √† partir de c√©r√©ales ou de pommes de terre. Base id√©ale pour de nombreux cocktails classiques comme le Moscow Mule ou le Cosmopolitan." },
  { name: "Gin", color: "#D4E8D4", origin: "üá¨üáß Angleterre", desc: "Eau-de-vie aromatis√©e aux baies de geni√®vre et diverses plantes botaniques. Incontournable pour le Martini, le Gin Tonic et le Negroni." },
  { name: "Rhum Blanc", color: "#FFF8DC", origin: "üå¥ Cara√Øbes", desc: "Eau-de-vie de canne √† sucre non vieillie, l√©g√®re et fra√Æche. La base parfaite du Mojito, de la Pi√±a Colada et du Daiquiri. I." },
  { name: "Rhum Ambr√©", color: "#D2691E", origin: "üå¥ Cara√Øbes", desc: "Rhum vieilli en f√ªts de ch√™ne qui d√©veloppe des notes de vanille, caramel et √©pices. Id√©al pour les cocktails Tiki." },
  { name: "Rhum Vieux", color: "#8B4513", origin: "üá≤üá∂ Martinique", desc: "Rhum agricole longuement vieilli, complexe et raffin√©. AOC Martinique, se d√©guste pur comme un cognac." },
  { name: "Tequila", color: "#F5F5DC", origin: "üá≤üáΩ Jalisco, Mexique", desc: "Spiritueux mexicain distill√© √† partir d'agave bleue. Blanco, Reposado ou A√±ejo. Base de la Margarita." },
  { name: "Whisky", color: "#CD853F", origin: "üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø √âcosse", desc: "Eau-de-vie de c√©r√©ales malt√©es vieillie en f√ªt. Notes de tourbe, miel et fruits secs. Pour le Whisky Sour." },
  { name: "Bourbon", color: "#8B4513", origin: "üá∫üá∏ Kentucky, USA", desc: "Whisky am√©ricain √† base de ma√Øs (min. 51%), vieilli en f√ªts neufs carbonis√©s. Parfait pour l'Old Fashioned." },
  { name: "Rye Whiskey", color: "#A0522D", origin: "üá∫üá∏ USA / üá®üá¶ Canada", desc: "Whisky de seigle au caract√®re √©pic√© et poivr√©. La base historique du Manhattan et du Sazerac." },
  { name: "Cognac", color: "#B8860B", origin: "üá´üá∑ Charente, France", desc: "Eau-de-vie de vin noble, double distillation en alambic charentais. VS, VSOP ou XO. Base du Sidecar." },
  { name: "Triple Sec", color: "#FFA500", origin: "üá´üá∑ France", desc: "Liqueur d'orange cristalline et parfum√©e. Cointreau et Grand Marnier sont les plus c√©l√®bres. Essentiel dans la Margarita." },
  { name: "Amaretto", color: "#8B0000", origin: "üáÆüáπ Saronno, Italie", desc: "Liqueur douce aux amandes am√®res et noyaux d'abricot. Saveur de massepain. Pour l'Amaretto Sour." },
  { name: "Kahl√∫a", color: "#3D1C02", origin: "üá≤üáΩ Veracruz, Mexique", desc: "Liqueur de caf√© mexicaine onctueuse. Incontournable dans le White Russian et l'Espresso Martini." },
  { name: "Baileys", color: "#F5DEB3", origin: "üáÆüá™ Dublin, Irlande", desc: "Cr√®me de whisky irlandais, onctueuse et velout√©e. M√©lange de whisky, cr√®me fra√Æche et cacao." },
  { name: "Campari", color: "#DC143C", origin: "üáÆüáπ Milan, Italie", desc: "Ap√©ritif amer italien d'un rouge iconique. Infusion secr√®te d'herbes et d'agrumes. Base du Negroni." },
  { name: "Vermouth R", color: "#722F37", origin: "üáÆüáπ Turin, Italie", desc: "Vin aromatis√© rouge aux herbes et √©pices. Doux et complexe. Indispensable au Negroni et Manhattan." },
  { name: "Vermouth D", color: "#E8E8D0", origin: "üá´üá∑ France", desc: "Vermouth dry blanc, sec et herbac√©. L'ingr√©dient cl√© du Martini Dry classique." },
  { name: "Chartreuse V", color: "#7FFF00", origin: "üá´üá∑ Alpes fran√ßaises", desc: "Liqueur verte des moines Chartreux depuis 1737. Recette secr√®te de 130 plantes. 55¬∞ d'intensit√©." },
  { name: "Chartreuse J", color: "#FFD700", origin: "üá´üá∑ Alpes fran√ßaises", desc: "Version jaune plus douce (40¬∞) de la Chartreuse. Notes de miel, safran et √©pices douces." },
  { name: "Absinthe", color: "#90EE90", origin: "üá®üá≠ Val-de-Travers", desc: "La F√©e Verte l√©gendaire, spiritueux anis√© aux herbes. Longtemps interdite. Pour le Sazerac." },
  { name: "Pastis", color: "#FFD700", origin: "üá´üá∑ Provence", desc: "Ap√©ritif anis√© embl√©matique du Sud. R√©glisse et anis √©toil√©, se trouble avec l'eau fra√Æche." },
  { name: "Sak√©", color: "#FFFFF0", origin: "üáØüáµ Japon", desc: "Alcool de riz ferment√© japonais, d√©licat et raffin√©. Junmai, Ginjo ou Daiginjo." },
  { name: "Mezcal", color: "#C4A000", origin: "üá≤üáΩ Oaxaca, Mexique", desc: "Spiritueux ancestral d'agave cuit au feu de bois. Notes fum√©es caract√©ristiques." },
  { name: "Cacha√ßa", color: "#F0E68C", origin: "üáßüá∑ Br√©sil", desc: "Eau-de-vie br√©silienne de jus de canne frais. L'√¢me de la Caipirinha nationale." },
  { name: "Pisco", color: "#FAEBD7", origin: "üáµüá™ P√©rou / üá®üá± Chili", desc: "Eau-de-vie de raisin sud-am√©ricaine cristalline. Base du c√©l√®bre Pisco Sour." },
  { name: "J√§germeister", color: "#2F4F4F", origin: "üá©üá™ Allemagne", desc: "Digestif allemand aux 56 herbes, racines et fruits. R√©glisse, anis et √©pices complexes." },
  { name: "Limoncello", color: "#FFFF00", origin: "üáÆüáπ C√¥te Amalfitaine", desc: "Liqueur de citron du sud de l'Italie. Zestes de citrons de Sorrente. Frais et acidul√©. II." },
  { name: "Midori", color: "#00FF00", origin: "üáØüáµ Japon", desc: "Liqueur de melon vert japonaise d'un vert √©clatant. Douce et fruit√©e, cr√©√©e par Suntory." },
  { name: "Blue Cura√ßao", color: "#0080FF", origin: "üá≥üá± √éle de Cura√ßao", desc: "Liqueur d'orange teint√©e d'un bleu √©lectrique. Donne sa couleur au Blue Lagoon." },
  { name: "Grenadine", color: "#FF1493", origin: "üá´üá∑ France", desc: "Sirop rouge vif √† base de grenade. Sucr√© et fruit√© pour le Tequila Sunrise." },
  { name: "Menthe", color: "#98FB98", origin: "üá´üá∑ France", desc: "Cr√®me de menthe verte, fra√Æche et intense. Get 27 est la plus connue. Pour le Grasshopper." },
  { name: "Frangelico", color: "#DEB887", origin: "üáÆüáπ Pi√©mont", desc: "Liqueur de noisettes du Pi√©mont aux notes de vanille et cacao. Bouteille en forme de moine." },
  { name: "Sambuca", color: "#F8F8FF", origin: "üáÆüáπ Rome", desc: "Liqueur anis√©e italienne, traditionnellement servie con la mosca (3 grains de caf√©) et flamb√©e. IV." },
  { name: "Calvados", color: "#D2B48C", origin: "üá´üá∑ Normandie", desc: "Eau-de-vie de cidre normande vieillie en f√ªt. Notes de pomme cuite et vanille. AOC." },
  { name: "Armagnac", color: "#DAA520", origin: "üá´üá∑ Gascogne", desc: "Plus ancienne eau-de-vie de vin de France. Plus rustique que le Cognac, ar√¥mes de pruneau." },
  { name: "Grappa", color: "#E6E6FA", origin: "üáÆüáπ Italie du Nord", desc: "Eau-de-vie italienne de marc de raisin. Digestif traditionnel apr√®s le repas italien." },
  { name: "Ouzo", color: "#F0FFF0", origin: "üá¨üá∑ Gr√®ce", desc: "Ap√©ritif anis√© grec traditionnel, se trouble avec l'eau. Accompagne les mezze grecs." },
  { name: "Raki", color: "#FFFAFA", origin: "üáπüá∑ Turquie", desc: "Lait du lion turc, spiritueux anis√© national. Se boit coup√© d'eau avec des mezze." },
  { name: "Soju", color: "#F5FFFA", origin: "üá∞üá∑ Cor√©e du Sud", desc: "Spiritueux cor√©en clair √† base de riz. 16-25¬∞, tr√®s populaire avec les repas cor√©ens." },
  { name: "Baijiu", color: "#FFFAF0", origin: "üá®üá≥ Chine", desc: "Spiritueux chinois de sorgho, le plus consomm√© au monde. Tr√®s fort (40-60¬∞), ar√¥me unique." },
  { name: "Aquavit", color: "#F0FFFF", origin: "üá≥üá¥ Scandinavie", desc: "Eau-de-vie scandinave au carvi et aneth. Tradition viking, servi glac√© avec le sm√∏rrebr√∏d." },
  { name: "Genever", color: "#E8E8D0", origin: "üá≥üá± Pays-Bas", desc: "Anc√™tre hollandais du gin, √† base de malt. Plus rond et malt√© que le London Dry." },
  { name: "Becherovka", color: "#8B4513", origin: "üá®üáø Karlovy Vary", desc: "Liqueur d'herbes tch√®que cr√©√©e en 1807. Notes de cannelle et clou de girofle." },
  { name: "Fernet", color: "#2F2F2F", origin: "üá¶üá∑ Argentine / üáÆüáπ Italie", desc: "Amer italien tr√®s intense, culte en Argentine avec du Coca. Digestif puissant." },
  { name: "Aperol", color: "#FF6347", origin: "üáÆüáπ Padoue", desc: "Ap√©ritif italien doux-amer orang√©, moins intense que Campari. Star de l'Aperol Spritz." },
  { name: "Cynar", color: "#556B2F", origin: "üáÆüáπ Italie", desc: "Liqueur am√®re √† base d'artichaut et 13 herbes. Go√ªt unique, l√©g√®rement v√©g√©tal." },
  { name: "Galliano", color: "#FFD700", origin: "üáÆüáπ Livourne", desc: "Liqueur dor√©e aux herbes, vanille et anis. Bouteille haute. Pour le Harvey Wallbanger." },
  { name: "B√©n√©dictine", color: "#8B6914", origin: "üá´üá∑ F√©camp", desc: "Liqueur aux 27 √©pices cr√©√©e par les moines b√©n√©dictins en 1510. DOM." },
  { name: "Drambuie", color: "#CD853F", origin: "üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø √âcosse", desc: "Liqueur √©cossaise de whisky, miel de bruy√®re et herbes. Pour le Rusty Nail." },
  { name: "Cointreau", color: "#FFF5EE", origin: "üá´üá∑ Angers", desc: "Triple sec premium cr√©√© en 1875. √âcorces d'oranges douces et am√®res. Pour la Margarita." },
  { name: "Grand Marnier", color: "#FF8C00", origin: "üá´üá∑ France", desc: "Liqueur d'orange au cognac cr√©√©e en 1880. Cordon Rouge iconique, parfait en digestif." },
  { name: "Maraschino", color: "#FDF5E6", origin: "üá≠üá∑ Zadar, Croatie", desc: "Liqueur de cerises Marasca et noyaux. Luxardo depuis 1821. Pour l'Aviation." },
  { name: "Cura√ßao", color: "#FF7F00", origin: "üá≥üá± Cura√ßao", desc: "Liqueur d'√©corces de laraha, orange am√®re locale. Version originale orange." },
  { name: "Kirsch", color: "#FFF8F8", origin: "üá©üá™ For√™t-Noire", desc: "Eau-de-vie de cerises noires avec noyaux. Pour la vraie For√™t-Noire et la fondue." },
  { name: "Tia Maria", color: "#1C1008", origin: "üáØüá≤ Jama√Øque", desc: "Liqueur de caf√© jama√Øcaine au rhum. Alternative au Kahl√∫a, plus l√©g√®re et √©pic√©e." },
  { name: "Advocaat", color: "#FFEC8B", origin: "üá≥üá± Pays-Bas", desc: "Liqueur cr√©meuse aux ≈ìufs et brandy. Texture √©paisse comme un custard. Pour le Snowball." },
  { name: "Suze", color: "#E8DC82", origin: "üá´üá∑ France", desc: "Ap√©ritif amer de gentiane jaune. Go√ªt v√©g√©tal et herbac√© unique. Tr√®s fran√ßais." },
  { name: "Amer Picon", color: "#FF6B35", origin: "üá´üá∑ Alg√©rie/France", desc: "Amer √† l'orange cr√©√© en Alg√©rie fran√ßaise. Base du Picon Bi√®re, culte dans le Nord." },
  { name: "St-Germain", color: "#F0FFF0", origin: "üá´üá∑ France", desc: "Liqueur de fleurs de sureau artisanale. Florale et d√©licate. Le bartender's ketchup." },
  { name: "Licor 43", color: "#FFD700", origin: "üá™üá∏ Carthag√®ne", desc: "Liqueur espagnole aux 43 ingr√©dients. Vanille dominante, douce et aromatique. III." }
];

const critiques = {
  excellent: [
    "Magnifique ! Un √©quilibre parfait digne des plus grands bars parisiens. Vous avez un don !",
    "Sublime harmonie de saveurs qui dansent sur le palais. Je suis sinc√®rement impressionn√©.",
    "Chef d'≈ìuvre liquide ! Ce cocktail m√©rite une place au panth√©on de la mixologie.",
    "Exceptionnel ! Les proportions sont parfaites, les saveurs se compl√®tent admirablement."
  ],
  good: [
    "Tr√®s agr√©able ! Un cocktail bien construit qui montre une vraie compr√©hension des saveurs.",
    "Belle r√©alisation. Les ingr√©dients se marient harmonieusement. Continuez ainsi !",
    "Savoureux et √©quilibr√© ! Quelques ajustements mineurs et ce sera parfait.",
    "Prometteur ! Vous √™tes sur la bonne voie pour devenir un excellent mixologue."
  ],
  average: [
    "Correct, mais il manque un petit quelque chose... du caract√®re peut-√™tre ?",
    "Potable. Il y a de l'id√©e mais l'ex√©cution laisse √† d√©sirer. Retravaillez les proportions.",
    "Moyen. Les saveurs se battent au lieu de s'harmoniser. Simplifiez peut-√™tre ?",
    "Bof. Ni vraiment bon ni vraiment mauvais. Un cocktail qui laisse indiff√©rent."
  ],
  bad: [
    "Hmm... C'est... int√©ressant ? Non, soyons honn√™tes, c'est tout simplement mauvais.",
    "Mon palais pleure de d√©sespoir. Qu'avez-vous fait subir √† ces pauvres ingr√©dients ?",
    "Un crime contre la mixologie ! Je vais devoir me rincer la bouche au champagne.",
    "Je pr√©f√©rerais honn√™tement boire l'eau de vaisselle. Au moins elle serait chaude."
  ],
  empty: [
    "Euh... Le verre est d√©sesp√©r√©ment vide. Vous testez le concept du cocktail invisible ?",
    "Je ne peux pas critiquer du vent. Versez quelque chose d'abord !",
    "L'art du vide, int√©ressant... mais non. Remplissez ce verre !"
  ]
};

function mixColors(colors) {
  if (colors.length === 0) return '#888888';
  if (colors.length === 1) return colors[0];
  let r = 0, g = 0, b = 0;
  colors.forEach(hex => {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    if (result) { r += parseInt(result[1], 16); g += parseInt(result[2], 16); b += parseInt(result[3], 16); }
  });
  return 'rgb(' + Math.floor(r/colors.length) + ',' + Math.floor(g/colors.length) + ',' + Math.floor(b/colors.length) + ')';
}

class LiquidDrop {
  constructor(x, y, color, vx = 0) {
    this.x = x; this.y = y; this.vy = 3; this.vx = vx;
    this.color = color; this.r = 4 + Math.random() * 3;
  }
  update() { 
    this.vy += 0.4; 
    this.y += this.vy; 
    this.x += this.vx;
    return this.y; 
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
    ctx.fill();
  }
}

class SplashParticle {
  constructor(x, y, color) {
    this.x = x; this.y = y;
    this.vx = (Math.random() - 0.5) * 14;
    this.vy = -Math.random() * 12 - 5;
    this.color = color; this.alpha = 1;
    this.r = 2 + Math.random() * 4;
  }
  update() { this.vy += 0.35; this.x += this.vx; this.y += this.vy; this.alpha *= 0.94; }
  draw() {
    ctx.globalAlpha = this.alpha;
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
    ctx.fill();
    ctx.globalAlpha = 1;
  }
}

const bottles = [];
const bottleW = 36;
const bottleH = 80;

function repositionElements() {
  const shelfStartY = 50;
  const shelfSpacing = 95;
  const bottleSpacing = 42;
  
  bottles.length = 0;
  
  const leftShelfWidth = 340;
  const bottlesPerShelf = Math.floor(leftShelfWidth / bottleSpacing);
  
  alcohols.forEach((alc, i) => {
    const half = Math.ceil(alcohols.length / 2);
    const side = i < half ? 'left' : 'right';
    const localIndex = side === 'left' ? i : i - half;
    const shelfIndex = Math.floor(localIndex / bottlesPerShelf);
    const posInShelf = localIndex % bottlesPerShelf;
    
    const baseX = side === 'left' ? 15 : W - leftShelfWidth - 5;
    const x = baseX + posInShelf * bottleSpacing;
    const y = shelfStartY + shelfIndex * shelfSpacing;
    
    bottles.push({
      ...alc, x: x, y: y, homeX: x, homeY: y,
      w: bottleW, h: bottleH, isDragging: false, angle: 0, offsetX: 0, offsetY: 0
    });
  });
  
  glass.x = W / 2;
  glass.y = H / 2 + 40;
  
  oliveJar.x = W / 2 + 140;
  oliveJar.y = H / 2 - 20;
  
  iceBox.x = W / 2 - 200;
  iceBox.y = H / 2 - 20;
  
  lemonPlate.x = W / 2 - 200;
  lemonPlate.y = H / 2 + 60;
}

const glass = { x: 0, y: 0, w: 110, h: 140, level: 0, maxLevel: 90, colors: [], ingredients: [], olives: 0, ice: 0, lemon: false };
const oliveJar = { x: 0, y: 0, w: 55, h: 75 };
const iceBox = { x: 0, y: 0, w: 65, h: 55 };
const lemonPlate = { x: 0, y: 0, w: 65, h: 45 };

let draggingBottle = null;
let draggingOlive = false;
let draggingIce = false;
let draggingLemon = false;
let dragX = 0, dragY = 0;
let liquidDrops = [];
let splashParticles = [];
let mouseX = 0, mouseY = 0;
let isShaking = false;
let shakeCount = 0;
let pouringFrame = 0;

repositionElements();

canvas.addEventListener('mousedown', e => {
  mouseX = e.clientX; mouseY = e.clientY;
  
  for (let b of bottles) {
    if (mouseX > b.x && mouseX < b.x + b.w && mouseY > b.y && mouseY < b.y + b.h) {
      draggingBottle = b;
      b.isDragging = true;
      b.offsetX = mouseX - b.x;
      b.offsetY = mouseY - b.y;
      cursor.classList.add('grabbing');
      isDragging = true;
      tooltip.style.display = 'none';
      return;
    }
  }
  
  if (mouseX > oliveJar.x && mouseX < oliveJar.x + oliveJar.w && mouseY > oliveJar.y && mouseY < oliveJar.y + oliveJar.h) {
    draggingOlive = true; dragX = mouseX; dragY = mouseY;
    cursor.classList.add('grabbing'); isDragging = true; return;
  }
  if (mouseX > iceBox.x && mouseX < iceBox.x + iceBox.w && mouseY > iceBox.y && mouseY < iceBox.y + iceBox.h) {
    draggingIce = true; dragX = mouseX; dragY = mouseY;
    cursor.classList.add('grabbing'); isDragging = true; return;
  }
  if (mouseX > lemonPlate.x && mouseX < lemonPlate.x + lemonPlate.w && mouseY > lemonPlate.y && mouseY < lemonPlate.y + lemonPlate.h) {
    draggingLemon = true; dragX = mouseX; dragY = mouseY;
    cursor.classList.add('grabbing'); isDragging = true; return;
  }
});

canvas.addEventListener('mousemove', e => {
  mouseX = e.clientX; mouseY = e.clientY;
  
  // Reset all hover states
  bottles.forEach(b => b.isHovered = false);
  
  if (!isDragging) {
    let found = false;
    for (let b of bottles) {
      if (mouseX > b.x && mouseX < b.x + b.w && mouseY > b.y && mouseY < b.y + b.h) {
        b.isHovered = true;
        tooltipTitle.textContent = b.name;
        tooltipOrigin.textContent = b.origin;
        tooltipDesc.textContent = b.desc;
        tooltip.style.display = 'block';
        tooltip.style.left = Math.min(mouseX + 15, W - 340) + 'px';
        tooltip.style.top = Math.min(mouseY + 15, H - 150) + 'px';
        found = true;
        break;
      }
    }
    if (!found) tooltip.style.display = 'none';
  }
  
  if (draggingBottle) {
    draggingBottle.x = mouseX - draggingBottle.offsetX;
    draggingBottle.y = mouseY - draggingBottle.offsetY;
    
    const centerX = draggingBottle.x + draggingBottle.w / 2;
    const centerY = draggingBottle.y + draggingBottle.h / 2;
    draggingBottle.angle = Math.atan2(mouseY - centerY, mouseX - centerX) - Math.PI / 2;
    
    // Limiter l'angle
    draggingBottle.angle = Math.max(-Math.PI * 0.6, Math.min(Math.PI * 0.6, draggingBottle.angle));
    
    const tilted = Math.abs(draggingBottle.angle) > Math.PI / 8;
    
    if (tilted && glass.level < glass.maxLevel) {
      pouringFrame++;
      if (pouringFrame % 2 === 0) {
        // Position du goulot selon l'angle
        const neckLength = draggingBottle.h * 0.22;
        const neckX = centerX + Math.sin(draggingBottle.angle) * (draggingBottle.h / 2 + 5);
        const neckY = centerY - Math.cos(draggingBottle.angle) * (draggingBottle.h / 2 + 5);
        
        // Direction du liquide selon l'inclinaison
        const pourVX = Math.sin(draggingBottle.angle) * 2;
        
        liquidDrops.push(new LiquidDrop(
          neckX + (Math.random() - 0.5) * 6, 
          neckY, 
          draggingBottle.color,
          pourVX
        ));
        
        if (!glass.ingredients.includes(draggingBottle.name)) {
          glass.ingredients.push(draggingBottle.name);
          glass.colors.push(draggingBottle.color);
        }
      }
    }
  }
  
  if (draggingOlive || draggingIce || draggingLemon) { dragX = mouseX; dragY = mouseY; }
});

canvas.addEventListener('mouseup', e => {
  cursor.classList.remove('grabbing');
  isDragging = false;
  pouringFrame = 0;
  
  if (draggingBottle) {
    draggingBottle.x = draggingBottle.homeX;
    draggingBottle.y = draggingBottle.homeY;
    draggingBottle.isDragging = false;
    draggingBottle.angle = 0;
    draggingBottle = null;
  }
  
  const inGlass = dragX > glass.x - glass.w/2 && dragX < glass.x + glass.w/2 && dragY > glass.y - glass.h/2 && dragY < glass.y + glass.h/2;
  
  if (draggingOlive && inGlass) {
    glass.olives++;
    for (let i = 0; i < 12; i++) splashParticles.push(new SplashParticle(dragX, dragY, '#32CD32'));
  }
  if (draggingIce && inGlass) {
    glass.ice++;
    for (let i = 0; i < 12; i++) splashParticles.push(new SplashParticle(dragX, dragY, '#87CEEB'));
  }
  if (draggingLemon && (dragX > glass.x - glass.w && dragX < glass.x + glass.w && dragY > glass.y - glass.h && dragY < glass.y)) {
    glass.lemon = true;
  }
  
  draggingOlive = false; draggingIce = false; draggingLemon = false;
});

function testCocktail() {
  const bubble = document.getElementById('critiqueBubble');
  const scoreEl = document.getElementById('critiqueScore');
  const textEl = document.getElementById('critiqueText');
  
  if (glass.level === 0) {
    scoreEl.textContent = "‚Äî";
    scoreEl.style.color = "#666";
    textEl.textContent = critiques.empty[Math.floor(Math.random() * critiques.empty.length)];
  } else {
    let score = 30 + Math.random() * 20;
    if (glass.ingredients.length >= 2 && glass.ingredients.length <= 4) score += 25;
    else if (glass.ingredients.length === 1) score += 10;
    else if (glass.ingredients.length > 4) score += 15;
    if (glass.ice > 0) score += 8;
    if (glass.olives > 0) score += 7;
    if (glass.lemon) score += 10;
    const fillPercent = glass.level / glass.maxLevel;
    if (fillPercent > 0.6 && fillPercent < 0.9) score += 15;
    
    const ings = glass.ingredients;
    if (ings.includes("Gin") && ings.includes("Vermouth D")) score += 12;
    if (ings.includes("Gin") && ings.includes("Vermouth R") && ings.includes("Campari")) score += 15;
    if (ings.includes("Vodka") && ings.includes("Kahl√∫a")) score += 10;
    if (ings.includes("Tequila") && ings.includes("Triple Sec")) score += 10;
    if (ings.includes("Bourbon") && ings.includes("Vermouth R")) score += 10;
    if (ings.includes("Cognac") && ings.includes("Triple Sec")) score += 10;
    if (ings.includes("Aperol") && ings.includes("Vermouth D")) score += 10;
    if (ings.includes("Rhum Blanc") && ings.includes("Menthe")) score += 10;
    if (ings.includes("Cacha√ßa") && ings.includes("Limoncello")) score += 8;
    
    score = Math.min(100, Math.max(0, Math.floor(score)));
    
    let category, color;
    if (score >= 80) { category = 'excellent'; color = '#228B22'; }
    else if (score >= 60) { category = 'good'; color = '#4682B4'; }
    else if (score >= 40) { category = 'average'; color = '#DAA520'; }
    else { category = 'bad'; color = '#DC143C'; }
    
    scoreEl.textContent = score + "%";
    scoreEl.style.color = color;
    textEl.textContent = critiques[category][Math.floor(Math.random() * critiques[category].length)];
  }
  bubble.classList.add('visible');
}

function closeCritique() { document.getElementById('critiqueBubble').classList.remove('visible'); }

function shakeGlass() {
  if (glass.level > 0 && glass.ingredients.length > 1) {
    isShaking = true; shakeCount = 0;
    document.getElementById('shakerIndicator').classList.add('visible', 'shaking');
    const shakeInterval = setInterval(() => {
      shakeCount++;
      document.getElementById('shakeCount').textContent = shakeCount;
      if (shakeCount >= 10) {
        clearInterval(shakeInterval);
        isShaking = false;
        document.getElementById('shakerIndicator').classList.remove('visible', 'shaking');
        glass.colors = [mixColors(glass.colors)];
      }
    }, 100);
  }
}

function resetGlass() {
  glass.level = 0; glass.colors = []; glass.ingredients = [];
  glass.olives = 0; glass.ice = 0; glass.lemon = false;
  liquidDrops = []; splashParticles = [];
}

function drawShelves() {
  ctx.fillStyle = '#5D3A1A';
  const shelfStartY = 50;
  const shelfSpacing = 95;
  const numShelves = Math.ceil(alcohols.length / 2 / 8) + 1;
  
  for (let i = 0; i < numShelves; i++) {
    const y = shelfStartY + i * shelfSpacing + bottleH;
    ctx.fillRect(5, y, 360, 10);
    ctx.fillRect(W - 365, y, 360, 10);
  }
}

function drawBottle(b) {
  ctx.save();
  ctx.translate(b.x + b.w / 2, b.y + b.h / 2);
  ctx.rotate(b.angle);
  ctx.translate(-b.w / 2, -b.h / 2);
  
  // Corps
  const gradient = ctx.createLinearGradient(0, 0, b.w, 0);
  gradient.addColorStop(0, 'rgba(255,255,255,0.35)');
  gradient.addColorStop(0.5, b.color);
  gradient.addColorStop(1, 'rgba(0,0,0,0.25)');
  ctx.fillStyle = gradient;
  ctx.fillRect(0, b.h * 0.22, b.w, b.h * 0.78);
  
  // Goulot
  ctx.fillStyle = '#3a3a3a';
  ctx.fillRect(b.w * 0.3, 0, b.w * 0.4, b.h * 0.22);
  
  // Bouchon
  ctx.fillStyle = '#6B3A1A';
  ctx.fillRect(b.w * 0.28, -4, b.w * 0.44, 6);
  
  // Contour
  ctx.strokeStyle = b.isDragging ? '#FFFF00' : 'rgba(255,255,255,0.5)';
  ctx.lineWidth = b.isDragging ? 2.5 : 1;
  ctx.strokeRect(0, b.h * 0.22, b.w, b.h * 0.78);
  
  // √âtiquette
  ctx.fillStyle = '#FFFFFF';
  ctx.fillRect(2, b.h * 0.34, b.w - 4, b.h * 0.34);
  ctx.strokeStyle = '#999';
  ctx.lineWidth = 1;
  ctx.strokeRect(2, b.h * 0.34, b.w - 4, b.h * 0.34);
  
  // Nom
  ctx.fillStyle = '#000';
  ctx.font = 'bold 8px Arial';
  ctx.textAlign = 'center';
  const name = b.name.length > 9 ? b.name.substring(0, 9) : b.name;
  ctx.fillText(name, b.w / 2, b.h * 0.54);
  
  ctx.restore();
}

function drawGlass() {
  const g = glass;
  const shakeOffset = isShaking ? (Math.random() - 0.5) * 10 : 0;
  
  ctx.save();
  ctx.translate(shakeOffset, 0);
  
  // Ombre
  ctx.fillStyle = 'rgba(0,0,0,0.3)';
  ctx.beginPath();
  ctx.ellipse(g.x, g.y + g.h / 2 + 6, g.w / 2 - 5, 10, 0, 0, Math.PI * 2);
  ctx.fill();
  
  const topY = g.y - g.h / 2;
  const topWidth = g.w;
  const stemTop = g.y + 18;
  const stemBottom = g.y + g.h / 2 - 6;
  const baseWidth = 40;
  
  // Liquide
  if (g.level > 0) {
    ctx.fillStyle = mixColors(g.colors);
    ctx.globalAlpha = 0.85;
    const liquidPercent = g.level / g.maxLevel;
    const liquidTopY = topY + (stemTop - topY) * (1 - liquidPercent);
    const liquidWidth = topWidth * liquidPercent;
    ctx.beginPath();
    ctx.moveTo(g.x - liquidWidth / 2, liquidTopY);
    ctx.lineTo(g.x + liquidWidth / 2, liquidTopY);
    ctx.lineTo(g.x + 5, stemTop);
    ctx.lineTo(g.x - 5, stemTop);
    ctx.closePath();
    ctx.fill();
    ctx.globalAlpha = 1;
  }
  
  // Gla√ßons
  for (let i = 0; i < g.ice; i++) {
    ctx.fillStyle = 'rgba(200,230,255,0.6)';
    const iceX = g.x - 20 + (i % 3) * 15;
    const iceY = g.y - 18 + Math.floor(i / 3) * 14;
    ctx.fillRect(iceX, iceY, 13, 13);
    ctx.strokeStyle = 'rgba(255,255,255,0.5)';
    ctx.strokeRect(iceX, iceY, 13, 13);
  }
  
  // Olives
  for (let i = 0; i < g.olives; i++) {
    ctx.fillStyle = '#228B22';
    ctx.beginPath();
    ctx.ellipse(g.x - 18 + i * 15, g.y - 5, 7, 5, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#FF0000';
    ctx.beginPath();
    ctx.arc(g.x - 18 + i * 15, g.y - 5, 2, 0, Math.PI * 2);
    ctx.fill();
  }
  
  // Verre martini
  ctx.strokeStyle = 'rgba(255,255,255,0.8)';
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(g.x - topWidth / 2, topY);
  ctx.lineTo(g.x + topWidth / 2, topY);
  ctx.lineTo(g.x + 5, stemTop);
  ctx.lineTo(g.x - 5, stemTop);
  ctx.closePath();
  ctx.stroke();
  
  // Pied
  ctx.beginPath();
  ctx.moveTo(g.x, stemTop);
  ctx.lineTo(g.x, stemBottom);
  ctx.stroke();
  
  // Base
  ctx.beginPath();
  ctx.moveTo(g.x - baseWidth / 2, stemBottom);
  ctx.lineTo(g.x + baseWidth / 2, stemBottom);
  ctx.stroke();
  ctx.beginPath();
  ctx.ellipse(g.x, stemBottom, baseWidth / 2, 5, 0, 0, Math.PI * 2);
  ctx.stroke();
  
  // Citron
  if (g.lemon) {
    ctx.fillStyle = '#FFD700';
    ctx.beginPath();
    ctx.arc(g.x + topWidth / 2 - 12, topY + 5, 10, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#FFFF00';
    ctx.beginPath();
    ctx.arc(g.x + topWidth / 2 - 12, topY + 5, 7, 0, Math.PI * 2);
    ctx.fill();
  }
  
  ctx.restore();
}

function drawAccessories() {
  // Olives
  ctx.fillStyle = 'rgba(200,255,200,0.2)';
  ctx.fillRect(oliveJar.x, oliveJar.y, oliveJar.w, oliveJar.h);
  ctx.strokeStyle = 'rgba(255,255,255,0.5)';
  ctx.lineWidth = 2;
  ctx.strokeRect(oliveJar.x, oliveJar.y, oliveJar.w, oliveJar.h);
  ctx.fillStyle = '#CD853F';
  ctx.fillRect(oliveJar.x - 2, oliveJar.y - 7, oliveJar.w + 4, 7);
  ctx.fillStyle = '#FFFFFF';
  ctx.font = '9px monospace';
  ctx.textAlign = 'center';
  ctx.fillText('OLIVES', oliveJar.x + oliveJar.w / 2, oliveJar.y - 11);
  for (let i = 0; i < 8; i++) {
    ctx.fillStyle = '#228B22';
    ctx.beginPath();
    ctx.ellipse(oliveJar.x + 12 + (i % 4) * 11, oliveJar.y + 18 + Math.floor(i / 4) * 22, 6, 5, 0, 0, Math.PI * 2);
    ctx.fill();
  }
  
  // Glace
  ctx.fillStyle = 'rgba(200,220,255,0.3)';
  ctx.fillRect(iceBox.x, iceBox.y, iceBox.w, iceBox.h);
  ctx.strokeStyle = 'rgba(255,255,255,0.5)';
  ctx.strokeRect(iceBox.x, iceBox.y, iceBox.w, iceBox.h);
  ctx.fillStyle = '#FFFFFF';
  ctx.fillText('GLACE', iceBox.x + iceBox.w / 2, iceBox.y - 6);
  for (let i = 0; i < 8; i++) {
    ctx.fillStyle = 'rgba(200,230,255,0.8)';
    ctx.fillRect(iceBox.x + 5 + (i % 4) * 15, iceBox.y + 8 + Math.floor(i / 4) * 22, 13, 13);
  }
  
  // Citrons
  ctx.fillStyle = 'rgba(255,255,255,0.2)';
  ctx.beginPath();
  ctx.ellipse(lemonPlate.x + lemonPlate.w / 2, lemonPlate.y + lemonPlate.h / 2, lemonPlate.w / 2, lemonPlate.h / 2, 0, 0, Math.PI * 2);
  ctx.fill();
  ctx.strokeStyle = 'rgba(255,255,255,0.4)';
  ctx.stroke();
  ctx.fillStyle = '#FFFFFF';
  ctx.fillText('CITRON', lemonPlate.x + lemonPlate.w / 2, lemonPlate.y - 6);
  for (let i = 0; i < 4; i++) {
    ctx.fillStyle = '#FFD700';
    ctx.beginPath();
    ctx.arc(lemonPlate.x + 14 + (i % 2) * 24, lemonPlate.y + 14 + Math.floor(i / 2) * 18, 9, 0, Math.PI * 2);
    ctx.fill();
  }
  
  // Drag items
  if (draggingOlive) {
    ctx.fillStyle = '#32CD32';
    ctx.beginPath();
    ctx.ellipse(dragX, dragY, 9, 7, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#FFFF00';
    ctx.lineWidth = 2;
    ctx.stroke();
  }
  if (draggingIce) {
    ctx.fillStyle = 'rgba(200,230,255,0.9)';
    ctx.fillRect(dragX - 10, dragY - 10, 20, 20);
    ctx.strokeStyle = '#FFFF00';
    ctx.strokeRect(dragX - 10, dragY - 10, 20, 20);
  }
  if (draggingLemon) {
    ctx.fillStyle = '#FFD700';
    ctx.beginPath();
    ctx.arc(dragX, dragY, 12, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = '#FFFF00';
    ctx.lineWidth = 2;
    ctx.stroke();
  }
}

function updateStats() {
  document.getElementById('statBottle').textContent = draggingBottle ? draggingBottle.name : 'Aucune';
  document.getElementById('statLevel').textContent = Math.min(Math.floor(glass.level / glass.maxLevel * 100), 100) + '%';
  document.getElementById('statIngredients').textContent = glass.ingredients.length;
  document.getElementById('statExtras').textContent = glass.olives + glass.ice + (glass.lemon ? 1 : 0);
  document.getElementById('composition').textContent = glass.ingredients.length > 0 ? glass.ingredients.join(', ') + (glass.lemon ? ', Citron' : '') : '-';
}

function animate() {
  ctx.fillStyle = '#0000AA';
  ctx.fillRect(0, 0, W, H);
  
  // Comptoir
  ctx.fillStyle = '#2F1810';
  ctx.fillRect(0, H - 65, W, 65);
  ctx.fillStyle = '#4A2512';
  ctx.fillRect(0, H - 65, W, 6);
  
  drawShelves();
  bottles.forEach(b => { if (!b.isDragging) drawBottle(b); });
  drawAccessories();
  drawGlass();
  
  // Bouteille en cours de drag (au-dessus)
  if (draggingBottle) drawBottle(draggingBottle);
  
  // Gouttes - tombent n'importe o√π
  liquidDrops = liquidDrops.filter(drop => {
    const y = drop.update();
    drop.draw();
    
    // Check si touche le verre
    const glassTop = glass.y - glass.h / 2;
    const glassBottom = glass.y + 18;
    const inGlassX = drop.x > glass.x - glass.w/2 && drop.x < glass.x + glass.w/2;
    const inGlassY = y > glassTop && y < glassBottom;
    
    if (inGlassX && inGlassY && glass.level < glass.maxLevel) {
      glass.level = Math.min(glass.level + 0.5, glass.maxLevel);
      for (let i = 0; i < 4; i++) splashParticles.push(new SplashParticle(drop.x, y, drop.color));
      return false;
    }
    
    // Splash au sol
    if (y > H - 65) {
      for (let i = 0; i < 3; i++) splashParticles.push(new SplashParticle(drop.x, H - 65, drop.color));
      return false;
    }
    
    return true;
  });
  
  // Splash
  splashParticles = splashParticles.filter(p => {
    p.update();
    p.draw();
    return p.alpha > 0.01;
  });
  
  updateStats();
  requestAnimationFrame(animate);
}

document.addEventListener('keydown', e => {
  if (e.code === 'KeyR') resetGlass();
  if (e.code === 'KeyS') shakeGlass();
  if (e.code === 'KeyT') testCocktail();
  if (e.code === 'Escape') { closeCritique(); closeSecretVideo(); }
});

// SECRET COMBINATION: ROLLS = Rhum, cura√ßO (orange), Limoncello, Licor43, Sambuca
// Hint: Les initiales forment un mot...
const secretCombination = ['Rhum Blanc', 'Cura√ßao', 'Limoncello', 'Licor 43', 'Sambuca'];
let secretVideoPopup = null;

function checkSecretCombination() {
  if (glass.ingredients.length !== 4) return false;
  // Check if ingredients contain R-O-L-S initials (4 ingredients for ROLS pattern)
  const initials = glass.ingredients.map(i => i.charAt(0).toUpperCase()).sort().join('');
  // ROLLS secret: Rhum (R), cura√ßO (O as second letter), Limoncello (L), Licor 43 (L), Sambuca (S)
  // Simplified: R + L + L + S = any combo with these starting letters
  const hasR = glass.ingredients.some(i => i.startsWith('Rhum'));
  const hasO = glass.ingredients.some(i => i.includes('Cura√ßao') || i.includes('Orange'));
  const hasL = glass.ingredients.filter(i => i.startsWith('L')).length >= 1;
  const hasS = glass.ingredients.some(i => i.startsWith('S'));
  
  // The actual secret: exactly Rhum + Limoncello + Licor 43 + Sambuca (RLLS)
  const secretIngredients = ['Rhum Blanc', 'Limoncello', 'Licor 43', 'Sambuca'];
  const hasAllSecret = secretIngredients.every(s => glass.ingredients.includes(s));
  
  return hasAllSecret;
}

function showSecretVideo() {
  if (secretVideoPopup) return;
  secretVideoPopup = document.createElement('div');
  secretVideoPopup.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#C0C0C0;border:2px outset #FFF;box-shadow:5px 5px 0 rgba(0,0,0,0.5);z-index:3000;';
  secretVideoPopup.innerHTML = `
    <div style="background:linear-gradient(90deg,#000080,#1084d0);color:#fff;padding:3px 6px;font-weight:bold;font-size:12px;display:flex;justify-content:space-between;align-items:center;">
      <span>üé≤ SECRET D√âCOUVERT</span>
      <div style="width:16px;height:14px;background:#C0C0C0;border:2px outset #fff;font-size:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;" onclick="closeSecretVideo()">√ó</div>
    </div>
    <div style="background:#000;padding:4px;">
      <video id="secretRollsVideo" controls autoplay style="width:500px;display:block;"><source src="rolls.mp4" type="video/mp4"></video>
    </div>
  `;
  document.body.appendChild(secretVideoPopup);
}

function closeSecretVideo() {
  if (secretVideoPopup) {
    const video = secretVideoPopup.querySelector('video');
    if (video) video.pause();
    secretVideoPopup.remove();
    secretVideoPopup = null;
  }
}

// Override testCocktail to check for secret
const originalTestCocktail = testCocktail;
testCocktail = function() {
  if (checkSecretCombination()) {
    showSecretVideo();
    return;
  }
  originalTestCocktail();
};

animate();
console.log('%cüç∏ Indice: Les initiales de certaines bouteilles forment un mot...', 'color: #FFD700; font-size: 10px;');

// SECRET: langue.mp4 - double-cliquer sur le verre
canvas.addEventListener('dblclick',e=>{
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;
  // V√©rifier si on clique sur le verre
  if(x>glass.x && x<glass.x+glass.w && y>glass.y && y<glass.y+glass.h){
    const popup=document.createElement('div');
    popup.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:10000';
    popup.innerHTML='<video src="langue.mp4" controls autoplay style="max-width:80%;max-height:80%"></video>';
    popup.onclick=()=>popup.remove();
    document.body.appendChild(popup);
  }
});
</script>
</body>
</html>
